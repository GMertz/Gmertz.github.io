---
title: Snake
---
	<script type="text/javascript">
		var can,ctx, intr, circs = [], wid = 5, canw, canh, lastInput, backCol = "black";
		window.onload = function()
		{
			//---Initialize Global Variables---
			can = document.getElementById("thing"),
			ctx = can.getContext("2d");
			can.width = 800;
			can.height = 800;
			canw = can.width;
			canh = can.height;
			ctx.lineWidth = 3;

			//---Event listeners---
			document.addEventListener("keydown",function(e){
				switch(e.keyCode)
				{
					case 37://left
						lastInput = 'l';
						break;
					case 38://up
						lastInput = 'u';
						break;
					case 39://right
						lastInput = 'r';
						break;
					case 40://down
						lastInput = 'd';
						break;
					default:
				}
			});

			var game = new SnakeGame(20);
			game.init();
			intr = setInterval(()=>game.tick(game),1000/10);
		}

		function clear()
		{
			ctx.globalAlpha = 1;
			ctx.fillStyle = backCol;
			ctx.fillRect(0,0,canw,canh);
		}

		function randomColor()
		{
			return `rgb(${Math.random()*255},${Math.random()*255},${Math.random()*255})`;
		}
		var Snake = function(x,y)
		{
			this.head = {x:x,y:y}
			this.len = 2;
			this.bod = [{x:x,y:y-1}];
			this.vel = {x:0,y:1};
			this.move = function()
			{
				var prev = {x:this.head.x-this.vel.x,y:this.head.y-this.vel.y};
				for(var i = 0; i < this.bod.length; i++)
				{
					var t = this.bod[i];
					this.bod[i] = prev;
					prev = t;
				}
			}
			this.draw = function()
			{
				var copy = this.bod.slice(0,this.bod.length);
				copy.unshift(this.head);
				return copy;
			}
			this.turn = function(dir)
			{
				if(dir == 'u' && dir.x != 0 && dir.y != -1)
					dir = {x:0,y:-1};
				else if(dir == 'r' dir.x != 1 && dir.y != 0)
					dir = {x:1,y:0};
				else if(dir == 'l' dir.x != -2 && dir.y != 0)
					dir = {x:-1,y:0};
				else if(dir == 'd' dir.x != 0 && dir.y != 1)
					dir = {x:0,y:1};
				this.vel = dir;
			}

		}

		var SnakeGame = function(dim)
		{
			var gameDim = dim;
			var squareWid = canw/gameDim;
			var board;
			var snek;
			var fruit;

			this.init = function()
			{
				board = [];
				snek = new Snake(Math.floor(gameDim/2),Math.floor(gameDim/2),gameDim);
				fruit;
				clear();
				this.drawGrid();
				this.setFruit();
			}


			this.setFruit = function()
			{
				this.clearBoard();
				var moves = [];
				for (let c of snek.draw())
				{
					board[c.x][c.y] = 1;
				}
				for(var i = 0; i < dim;  i++)
					for(var k = 0; k < dim;  k++)
						if(!board[i][k])
							moves.push([i,k]);

				var t = Math.floor(Math.random()*moves.length);
				fruit = {x:moves[t][0],y:moves[t][1]};
			}

			this.drawCell = function(x,y,color)
			{
				ctx.beginPath();
				ctx.fillStyle = color;
				ctx.fillRect(x*squareWid,y*squareWid,squareWid,squareWid);
				ctx.fill();
			}
			this.checkBody = function(mv)
			{
				for(let c of snek.bod)
				{
					if(c.x == mv.x && c.y == mv.y)
						return true;
				}
				return false;
			}
			this.check = function()
			{
				var s = snek;
				var mv = {
					x:s.head.x + s.vel.x,
					y:s.head.y + s.vel.y
				};
				if(mv.x > gameDim-1
				|| mv.x < 0
				|| mv.y >gameDim-1
				|| mv.y < 0
				|| this.checkBody(mv))
				{
					return false;
				}
				else
				{
					s.head.x +=s.vel.x;
					s.head.y +=s.vel.y;
				}
				if(s.head.x == fruit.x && s.head.y == fruit.y)
				{
					this.drawCell(fruit.x,fruit.y,"black");
					s.bod.push(s.bod[s.bod.length-1]);
					this.setFruit();
				}
				return true;
			}

			this.tick = function(self)
			{
				var pre = snek.draw();
				if(lastInput)
				{
					snek.turn(lastInput);
					lastInput = 0;
				}

				if(self.check())
				{
					snek.move();
					for(let tod of pre)
						self.drawCell(tod.x,tod.y,backCol);
					for(let tod of snek.draw())
						self.drawCell(tod.x,tod.y,"white");

					self.drawCell(fruit.x,fruit.y,randomColor());
					self.drawGrid();
				}
				else
				{
					this.init();
				}
			}
			this.clearBoard = function()
			{
				board = [];
				for(var i = 0; i < gameDim; i++){
					var row = []
					for(var k = 0; k < gameDim; k++)
						row.push(0);
					board.push(row);
				}
			}

			this.drawGrid = function()
			{
				ctx.strokeStyle = "grey";
				for(var i = 0; i <= gameDim; i++)
				{
					ctx.beginPath();
					ctx.moveTo(squareWid*i,0);
					ctx.lineTo(squareWid*i,canh);
					ctx.stroke();

					ctx.beginPath();
					ctx.moveTo(0,squareWid*i);
					ctx.lineTo(canw,squareWid*i);
					ctx.stroke();
				}
			}
		}
	</script>
</head>
	<canvas id="thing" style="display:block; margin: auto;"></canvas>
